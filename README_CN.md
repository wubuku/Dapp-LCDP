# 一个 Dapp 低代码开发平台

[English](README.md) | 中文

[ToC]

## 我们想要做什么

一个**真正的**低代码开发平台（Low-code development platform，LCDP），帮助开发者构建最大化地使用区块链作为技术基础设施的去中心化应用（Dapp）。

一个低代码开发平台，让开发者可以极接近开发“传统”应用的体验，去构建极复杂的去中心化应用。

在起步阶段，这个平台会优先支持构建运行在 Move 公链上 Dapp。

更长远的目标，平台不限制开发者使用何种编程语言去构建 Dapp，让开发者可以专注于“业务逻辑”的实现。于是“传统”应用的开发者也可以更便捷地享受到区块链发展的红利；而当前已经高度复杂的“传统”企业软件和 Web 2.0 互联网应用可以低成本地迁移到链上，成为去中心化的 Web 3.0 应用。

## 何谓“真正的”低代码开发平台

“你们所说的‘真正的’低代码开发平台是什么？”

这里我们认为有必要澄清“低代码”和“无代码”的区别。无代码更多地是指一类面向“最终用户”的工具，通过这些工具，用户能够快速地组装出一些应用来。比如一些互联网表单工具、建站工具等。而低代码平台，我们认为是面向专业开发人员的。

我们认为真正的低代码开发平台应该具备以下关键特性：

* **模型驱动**开发。这个模型最好是尽可能离“技术”远、离“业务”近的“领域模型”。因为“沟通”是复杂软件开发中最大的成本——即使低代码平台是面向开发者的，“无代码”是面向最终用户（业务人员）的。

* **可视化开发**。可视化建模工具是低代码平台可视化开发工具箱的重要组成部分。不过，需要指出的是，如果建模工具可以将模型保存为可读性良好的纯文本，那么这个文本的规范其实就是一门 DSL（领域专门语言），这样的 DSL 其实开发人员是可以手写（不需要借助可视化建模工具）。

* 支持**表达式语言**的使用。表达式语言应该比通用编程语言（GPL）更简单，更易于编写业务逻辑。它应该是函数式的；它应该尽可能是声明式的——即用于表达“想要什么”而非“怎么做”。

* **系统的软件工程支持**。低代码平台应该集成开发、Debug、测试、版本控制、DevOps 等软件工程领域的最佳实践。

* **开放集成并且可扩展**。代码平台开发的应用应该具有开放的 API 以及可以使用外部的 API，并且能使用通用编程语言进行扩展。



## 我们是谁

【TBD】

## 技术架构

【TBD】

## 概念验证：一个演示性的域名系统

### Demo 的目的

从大的方面说，我们其实试图探讨一种可以极大地降低传统应用开发者迈入 Dapp 领域的门槛的开发模式。理想中的“极低门槛”应该是这样的：开发人员只需要构建领域模型，编写（存粹的）业务逻辑代码。这些代码理应可以在 L1/L2、链上/链下、中心化数据库/去中心化账本等不同的技术基础设施之间迁徙而不需要开发人员手动修改。

这显然是一个极具挑战性的目标。因为不同的区块链有不同的特性，我们的低代码平台的设计是否可以有效地应对基础设施的多样性所带来的挑战？对此我们当然是有极大的信心的，我们将通过开发一个 Demo 域名系统来证明这一点。

我们知道，之前 Move（Move 虚拟机）没有类似 Solidity（以太坊虚拟机）的 Mapping 这样的数据结构；就算接下来 Move 会支持 Table（Mapping），它也不应该被滥用。

因为对 Mapping 的滥用会造成所谓的区块链状态膨胀的问题。在 L1 链上的 Mapping 中存储大量的状态数据不是一个值得推荐的实践，它们应该存储在链下（或者说 L1 链外），但同时这些数据又需要在链上可以被验证和使用。

所以，在不使用 Table（Mapping）的前提下，在 Move 链上构建一个域名系统是一件具有相当复杂度的开发工作；接下来我们可以看到基于 DDD 和 DSL 的开发模式（低代码平台）可以如何极大地减轻开发者完成这件工作的负担。


### 如何证明

第一步，我们手动编写这个 Demo 应用的实现代码（已完成）；它们应该解耦为如下三部分：

1. 可以重用的和应用领域（域名系统）的业务逻辑无关的库。
2. 可以从（DSL 描述的）模型生成的样板代码（boilerplate code）。
3. 纯粹的业务逻辑代码。需要说明的是，这个 Demo 的业务逻辑是使用 Move 编写、在 Starcoin链（L1）上执行的，但在此基础上很有潜力演化出更复杂的实现。 

第二步，我们制作代码生成工具，把上面的第 2 部分代码模板化（待完成）。然后，我们可以删除上面所说的第 2 部分代码，使用模型（+代码模板）重新生成这部分代码，应用应该可以正常编译和运行。

需要说明的是，尽管我们还没有完成第二步，但是任何有经验的开发人员都可以通过阅读我们在第一步完成的源代码得到肯定的结论：真正的业务逻辑代码（它们确实需要开发人员编写）非常有限，源代码中的 90% 都是可以从模型生成的样板代码。

#### Demo 的源代码

Demo 的源代码见此 [GitHub 仓库](https://github.com/wubuku/StarcoinNSDemo)。


### “域名系统”的功能

为便于在有限的时间内完成概念验证，我们生造一些简单但基本可以说明问题的“域名系统”的功能需求如下：

* 支持域名的注册与续费。提交域名注册的交易需要传入域名状态的不存在证明（Non-Membership Proof）；提交续费域名的交易需要传入域名状态的存在证明（Membership Proof）。

* 只需要支持二级域名。这是为了演示实体 ID 不是一个“基本类型”，而是有两个字段的“复杂”值对象的情况。

### Demo 系统的架构

Demo 域名系统由三部分组成：

![Demo Domain Name System Architecture](DemoDomainNameSysArch.jpeg)

- 客户端。客户端向链上合约提交交易前，先向链下服务请求获取实体（域名）的状态以及其状态证明。
- 链上合约。链上合约不保存所有域名的“当前状态”，只保存着所有域名状态的SMT Root。链上合约执行交易时，先验证客户端提交过来的状态和状态证明，然后再执行业务逻辑、更新 SMT Root。
- 链下服务。链下服务通过从链上拉取事件，在本地数据库中构建出所有域名的“当前状态”。任何人都可以运行链下服务的实例，且无法作恶（伪造状态信息），这就保证了系统的去中心化。


## 关键风险

【TBD】

